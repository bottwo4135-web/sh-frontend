{% extends 'base.html' %}
{% block content %}
<section class="auth-card slide-up">
  <h2>Create your {{ role|capitalize }} account</h2>
  <form class="form" method="post" enctype="multipart/form-data">
    <div class="grid-2">
      <label>Full name
        <input required name="name" placeholder="Jane Doe" />
      </label>
      <label>Email
        <input type="email" required name="email" placeholder="jane@example.com" />
      </label>
    </div>
    <div class="grid-2">
      <label>Password
        <input type="password" required name="password" placeholder="••••••••" />
      </label>
      {% if role == 'doctor' %}
      <label>Specialty
        <input name="specialty" placeholder="Cardiology" />
      </label>
      {% else %}
      <div></div>
      {% endif %}
    </div>
    <label>Profile picture
      <input type="file" name="avatar" accept="image/*" />
    </label>
    <button class="btn primary w-100" type="submit">Create account</button>
  </form>
  <div class="muted">Already have an account? <a href="{{ url_for('login') }}">Login</a></div>
</section>
{% endblock %}
{% block scripts %}
<script>
  const BASE_URL = 'https://shs-backend-ktg8.onrender.com';
  document.querySelector('.form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    let role = '{{ role }}';
    let endpoint = `${BASE_URL}/signup/${role}`;
    const res = await fetch(endpoint, { method: 'POST', body: formData });
    if (res.ok) {
      // Redirect to dashboard based on role
      if (role === 'doctor') {
        window.location.href = '/doctor';
      } else {
        window.location.href = '/patient';
      }
    } else {
      alert('Signup failed. Please check your details.');
    }
  });
</script>
{% endblock %}
